#!/bin/bash
#######################################
# Handle the installation of tools
#######################################
# Create a Python virtual to address PEP668 error
# See https://peps.python.org/pep-0668/
# See https://github.com/python/cpython/issues/102134
cd /root
python3 -m venv python-env
chmod -R +x python-env
source python-env/bin/activate
which python
python -m pip install wheel
python -m pip install requests pipreqs
# Create the share folder
mkdir /tools/reports
# Ones via GIT repository cloning with sometimes local compilation/install commands
git clone --depth 1 https://github.com/maurosoria/dirsearch.git /tools/dirsearch
git clone --depth 1 https://github.com/drwetter/testssl.sh /tools/testssl
git clone --depth 1 https://github.com/sullo/nikto.git /tools/nikto
git clone --depth 1 https://github.com/danielmiessler/SecLists.git /tools/sec-lists
git clone --depth 1 https://github.com/stamparm/identYwaf.git /tools/identYwaf
git clone --depth 1 https://github.com/danielmiessler/RobotsDisallowed.git /tools/robots-disallowed
git clone --depth 1 https://github.com/righettod/website-passive-reconnaissance.git /tools/website-passive-reconnaissance
git clone --depth 1 https://github.com/sqlmapproject/sqlmap.git /tools/sqlmap
git clone --depth 1 https://github.com/no0be/vhost-brute.sh.git /tools/vhost-brute
git clone --depth 1 https://github.com/infodox/python-pty-shells.git /tools/python-pty-shells
git clone --depth 1 https://github.com/rebootuser/LinEnum.git /tools/privesc-linux-enumeration
git clone --depth 1 https://github.com/mzet-/linux-exploit-suggester.git /tools/exploit-suggester-linux
git clone --depth 1 https://github.com/bitsadmin/wesng.git /tools/exploit-suggester-windows
git clone --depth 1 https://github.com/samratashok/nishang.git /tools/offensive-powershell-scripts
git clone --depth 1 https://github.com/carlospolop/privilege-escalation-awesome-scripts-suite.git /tools/privesc-awesome-scripts-suite
git clone --depth 1 https://github.com/ptoomey3/evilarc.git /tools/zip-slip-generator
git clone --depth 1 https://github.com/abdulfatir/ZipBomb.git /tools/zip-bomb-generator
git clone --depth 1 https://github.com/digininja/RSMangler.git /tools/password-mangler
git clone --depth 1 https://github.com/jonaslejon/malicious-pdf.git /tools/malicious-pdf-generator
git clone --depth 1 https://github.com/secretsquirrel/SigThief.git /tools/sig-thief
cd /tmp
wget -q https://download.sysinternals.com/files/ProcessMonitor.zip -O procmon.zip
unzip procmon.zip
mv Procmon*.exe /tools/sig-thief/.
git clone --depth 1 https://github.com/tyleradams/json-toolkit.git /tools/json-toolkit
cd /tools/json-toolkit
sed -i 's/sudo//g' Makefile
make
make install
echo "cat before.xml | xml-to-json" > /tools/json-toolkit/sample-usage.txt
echo "See https://codefaster.substack.com/p/mastering-jq-xml-and-any-other-data" >> /tools/json-toolkit/sample-usage.txt
git clone https://github.com/arno-di-loreto/jq-and-openapi.git /tools/jq-openapi-filters-collection
cd /tools/jq-openapi-filters-collection
git pull --all
git clone --depth 1 https://github.com/internetwache/GitTools.git /tools/git-repo-recovery-toolkit
git clone --depth 1 https://github.com/Ganapati/RsaCtfTool.git /tools/rsa-recovery-toolkit
git clone --depth 1 https://github.com/dolevf/graphw00f.git /tools/graphw00f
git clone --depth 1 https://github.com/NickstaDB/xamarin-decompress.git /tools/xamarin-decompress
git clone --depth 1 https://github.com/floyd-fuh/JKS-private-key-cracker-hashcat.git /tools/prepare-jks-for-hashcat-cracking
git clone --depth 1 https://github.com/nccgroup/nmap-nse-vulnerability-scripts.git /tools/nccgroup-nmap-nse-scripts
git clone --depth 1 https://github.com/KINGSABRI/bigip2ip.git /tools/bigip-decoder
git clone --depth 1 https://github.com/cisagov/log4j-scanner.git /tools/log4shell-scanner
git clone --depth 1 https://github.com/Viralmaniar/MurMurHash.git /tools/murmurhash-generator
git clone --depth 1 https://github.com/t3l3machus/psudohash.git /tools/password-derivation
git clone --depth 1 https://github.com/badkeys/badkeys.git /tools/badkeys
cd /tools/badkeys
python setup.py install
bash getbl.sh
git clone --depth 1 https://github.com/projectdiscovery/fuzzing-templates.git /tools/nuclei-fuzzing-templates
git clone --depth 1 https://github.com/iknowjason/edge.git /tools/edge
cd /tools/edge
go build edge.go
git clone --depth 1 https://github.com/blechschmidt/massdns.git /tools/massdns
cd /tools/massdns
make
make install
git clone --depth 1 https://github.com/d4rckh/gorilla.git /tools/wordlist-generator
cd /tools/wordlist-generator
/root/.cargo/bin/cargo build --release
git clone --depth 1 https://github.com/robertdavidgraham/masscan.git /tools/masscan
cd /tools/masscan
make
make install
# Ones via release downloading
mkdir /tools/ysoserial
wget -q https://jitpack.io/com/github/frohoff/ysoserial/master-SNAPSHOT/ysoserial-master-SNAPSHOT.jar -O /tools/ysoserial/ysoserial.jar
mkdir /tools/venom-ovh
wget -q https://github.com/ovh/venom/releases/download/v1.0.0-rc.2/venom.linux-amd64 -O /tools/venom-ovh/venom
cd /tools/venom-ovh
chmod +x venom
./venom update
mkdir /tools/jdam
wget -q https://gitlab.com/api/v4/projects/22765596/packages/generic/jdam/0.2.0/jdam-linux-amd64-v0.2.0-alpha -O /tools/jdam/jdam
mkdir /tools/container-diff
wget -q https://storage.googleapis.com/container-diff/latest/container-diff-linux-amd64 -O /tools/container-diff/container-diff
wget -q https://raw.githubusercontent.com/GoogleContainerTools/container-diff/master/README.md -O /tools/container-diff/README.md
mkdir /tools/speedtest
wget -q -O /tools/speedtest/speedtest.tgz https://install.speedtest.net/app/cli/ookla-speedtest-1.0.0-x86_64-linux.tgz
cd /tools/speedtest
tar xf speedtest.tgz
rm speedtest.tgz
# Ones via PIP
python -m pip install shodan pycryptodomex httpie tabulate ansi2html asciinema droopescan pycurl wfuzz pipreqs regexploit name-that-hash mmh3 jmespath git-dumper pyjks lxml signxml cryptography requests xortool ds-store defaultcreds-cheat-sheet
BUILD_LIB=1 python -m pip install ssdeep
# Ones via NPM
npm install -g retire js-beautify http-server
# One via GEM
gem install mdless ssh_scan
# Ones via GO install system
export GO111MODULE=on
go install github.com/ffuf/ffuf/v2@latest
go install github.com/projectdiscovery/nuclei/v2/cmd/nuclei@latest
go install github.com/projectdiscovery/interactsh/cmd/interactsh-client@latest
go install github.com/projectdiscovery/naabu/v2/cmd/naabu@latest
go install github.com/projectdiscovery/httpx/cmd/httpx@latest
go install github.com/projectdiscovery/dnsx/cmd/dnsx@latest
go install github.com/projectdiscovery/subfinder/v2/cmd/subfinder@latest
go install github.com/projectdiscovery/katana/cmd/katana@latest
go install github.com/projectdiscovery/cdncheck/cmd/cdncheck@latest
go install github.com/hakluke/hakrawler@latest
go install github.com/OJ/gobuster/v3@latest
go install github.com/fullstorydev/grpcurl/cmd/grpcurl@latest
go install github.com/visma-prodsec/confused@latest
go install github.com/zricethezav/gitleaks@latest
go install github.com/wader/fq@latest
go install github.com/vdjagilev/nmap-formatter@latest
go install github.com/liamg/guerrilla/cmd/guerrilla@latest
go install github.com/mikefarah/yq/v4@latest
go install github.com/joanbono/gap@latest
go install github.com/d3mondev/puredns/v2@latest
/root/go/bin/nuclei -update-templates
/root/go/bin/nuclei -update
ln -s /root/go/bin/gap /usr/bin/google-api-checker
# One via CARGO install system
/root/.cargo/bin/cargo install htmlq bat cargo-cache
# Build the local favicon DB
mkdir /tools/favicon-db
cd /tools/favicon-db
chmod +x /tools/scripts/generate-favicon-db.sh
bash /tools/scripts/generate-favicon-db.sh
# Failover if nuclei and its templates were not currectly installed from the recommanded way
if [ ! -f "/root/go/bin/nuclei" ]; then
	wget -O nuclei.zip https://github.com/projectdiscovery/nuclei/releases/download/v2.9.6/nuclei_2.9.6_linux_amd64.zip
	unzip -d /root/go/bin nuclei.zip
	rm nuclei.zip
	chmod +x /root/go/bin/nuclei
	/root/go/bin/nuclei -update
	/root/go/bin/nuclei -update-templates
fi
if [ ! -d "/root/nuclei-templates" ]; then
	git clone --depth 1 https://github.com/projectdiscovery/nuclei-templates.git /root/nuclei-templates	
fi
# Install dependencies via PIP for tools as well as templates and custom scripts
for f in $(ls /tools/*/requirements.txt)
do
	python -m pip install -r $f
done
# Generate "requirements.txt" file for custom python scripts/templates and install dependencies
cd /tools/scripts
pipreqs . --force
python -m pip install -r requirements.txt
cd /tools/templates
pipreqs . --force
python -m pip install -r requirements.txt
tldextract --update
# Patch for the python package "dnsdumpster"
# See https://github.com/PaulSec/API-dnsdumpster.com
# The version in pypi do not contain the patch to fix the error due to 
# change of the result format returned by dnsdumpster.com
# See https://github.com/PaulSec/API-dnsdumpster.com/commit/fa952c6cbdf32f70ed1af60ac318907898e0e8ac
python -m pip uninstall --yes dnsdumpster
python -m pip install https://github.com/PaulSec/API-dnsdumpster.com/archive/master.zip
# Update default creds DB
creds update
# Update WPScan DB
wpscan --no-banner --update
# Setup the list of DNS public resolvers for PureDNS
mkdir -p /root/.config/puredns
cp /tools/dictionaries/dns-resolvers.txt /root/.config/puredns/resolvers.txt
echo 0
