#!/bin/bash
###
# Cf https://github.com/ffuf/ffuf#usage
# Use -fl X to skip responses with X number of lines
#     -fs X to skip responses with a response size of X bytes
#     -fw X to skip responses with X words
#     -fl 12,25 to skip responses with 12 or 25 number of lines (same syntax for 'fs' and 'fw')
###
EXTRA_FFUF_OPTS=""
COOKIES="a=b"
AUTHENTICATION_HEADER="X-Origin: ABC"
PROXY=""
IGNORE_HTTP_CODES="400,403,404"
THREAD_COUNT="10"
###
DICT_HOME="/tools/sec-lists/Discovery/Web-Content"
REPORT_HOME="/tools/reports"
FFUF_RUN_STORAGE="$REPORT_HOME/ffuf_run_files"
EXTENSIONS=".asp,.aspx,.jsp,.php,.html,.htm,.js,.min.js,.js.map,.txt,.json,.lock,.config.js,-config.js,.properties"
###
if [ "$PROXY" != "" ];
then
	ffuf_proxy="-x $PROXY"
	curl_proxy="--proxy $PROXY"
else
	ffuf_proxy=""
	curl_proxy=""
fi
base_target=$1
opts=" $EXTRA_FFUF_OPTS -recursion -recursion-depth 5 $ffuf_proxy -fc $IGNORE_HTTP_CODES -c -ic -timeout 30 -t $THREAD_COUNT "
dicts=("quickhits.txt" "common.txt" "graphql.txt" "swagger.txt" "spring-boot.txt" "axis.txt" "Common-DB-Backups.txt" "versioning_metafiles.txt" "raft-small-words.txt")
for dict in ${dicts[@]}; do
	entries_count=$(wc -l $DICT_HOME/$dict | cut -d' ' -f1)
	echo -e "\e[93m[+] Test using '$dict' ($entries_count entries) ...\e[0m"
	if [ "$dict" != "raft-small-words.txt" ];
	then
		ffuf $opts -w $DICT_HOME/$dict -u $base_target/FUZZ -b "$COOKIES" -H "$AUTHENTICATION_HEADER"
	else
		ffuf $opts -e $EXTENSIONS -w $DICT_HOME/$dict -u $base_target/FUZZ -b "$COOKIES" -H "$AUTHENTICATION_HEADER"
	fi
done
echo -e "\e[93m[+] Last test using raft-large-words.txt combined with raft-large-extensions.txt ...\e[0m"
rm -rf $FFUF_RUN_STORAGE 2>/dev/null 
mkdir $FFUF_RUN_STORAGE 2>/dev/null
opts=" $EXTRA_FFUF_OPTS $ffuf_proxy -fc $IGNORE_HTTP_CODES -c -ic -timeout 30 -t $THREAD_COUNT "
ffuf $opts -w "$DICT_HOME/raft-large-words.txt:FNAME" -w "$DICT_HOME/raft-large-extensions.txt:EXT" -o "$REPORT_HOME/ffuzz.json" -of json -od "$FFUF_RUN_STORAGE" -u "$base_target/FNAMEEXT" -b "$COOKIES" -H "$AUTHENTICATION_HEADER"

