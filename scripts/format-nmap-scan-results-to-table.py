#!/usr/bin/env python
import argparse
from tabulate import tabulate

"""
Script to format a Grepable (-oG) report of a NMAP scan to a table.

nmap -Pn --open -p- -oG report.txt [CDIR]

Dependencies:
    pip3 install tabulate
"""

def my_key(item):
    v = str(item[0]).replace(".","")
    return int(v)

if __name__ == "__main__":
    parser = argparse.ArgumentParser(description="Format a Grepable (-oG) report of a NMAP scan to a table.")
    required_params = parser.add_argument_group("required named arguments")
    required_params.add_argument("-f", action="store", dest="report_file", help="Path to the Grepable (-oG) report of a NMAP scan.", required=True)
    args = parser.parse_args()
    report_file = args.report_file
    table_lines = []
    with open(report_file, mode="r") as f:
        lines = f.read().splitlines()
    for line in lines:
        if "Ports:" in line:
            parts = line.split("()")
            host = parts[0].replace("Host:","").strip(" ")
            data_ports = parts[1].replace("Ports:","").replace("Ports:","").strip(" ").split(",")
            ports = []
            for data_port in data_ports:
                ports.append(int(data_port.split("/")[0].strip(" \t")))
            ports.sort()
            table_lines.append([host," ".join(map(str,ports))])
    sorted_table_data = sorted(table_lines, key=my_key, reverse=False)
    print(tabulate(sorted_table_data, headers=["Host","Ports"], tablefmt="outline"))
